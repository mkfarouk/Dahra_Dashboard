<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aldahra Agricultural Company - Enhanced Dashboard</title>
    
    <!-- External Libraries -->
    

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <link rel="stylesheet" href="assets/css/variables.css" />
    <link rel="stylesheet" href="assets/css/theme-dark.css" />
    <link rel="stylesheet" href="assets/css/base.css" />
    <link rel="stylesheet" href="assets/css/layout.css" />

    <link rel="stylesheet" href="assets/css/components-crop-cards.css" />
    <link rel="stylesheet" href="assets/css/components-varieties.css" />
    <link rel="stylesheet" href="assets/css/components-charts.css" />
    <link rel="stylesheet" href="assets/css/components-sidebar.css" />
    <link rel="stylesheet" href="assets/css/components-loading.css" />

    <link rel="stylesheet" href="assets/css/utilities.css" />
    <link rel="stylesheet" href="assets/css/responsive.css" />
    <link rel="stylesheet" href="assets/css/production-glow.css" />

    <script type="module" src="assets/js/mock/mockData.js"></script>
    <style>

        .site-footer {
  background-color: #f1f1f1;
  padding: 20px;
  text-align: center;
  font-size: 14px;
  color: #333;
  position: relative;
  bottom: 0;
  width: 100%;
}

.footer-nav {
  margin-top: 10px;
}

.footer-link {
  margin: 0 10px;
  text-decoration: none;
  color: #333;
  font-weight: 500;
  transition: color 0.3s ease;
}

.footer-link:hover {
  color: #81c784; /* highlight color */
}

</style>



    
</head>
<body>
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinning">
                <i class="fas fa-leaf"></i>
            </div>
            <p>Loading Enhanced Agricultural Dashboard...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                     <div class="logo-section">
                <!-- Aldahra Logo -->
               <a href="https://aldahra.com/" target="_blank"><img src="assets/img/Al-Dahra-Agriculture-Egypt-53315-1594802755-og-removebg-preview.png" alt="Aldahra Logo" class="company-logo"></a> 
                <a href="https://sut.edu.eg/" target="_blank"><img src="assets/img/050b6556-52e3-4663-aa36-d8a484bf91e2.png" alt="" style="width: 20px; height:20px;"></a>
                <a href="https://aast.edu/en/" target="_blank"><img src="assets/img/AAST.png" alt="" style="width: 20px; height:20px;"></a>
               <a href="https://www.asu.edu.eg/ar" target="_blank"><img src="assets/img/OIP-removebg-preview.png" alt=""  style="width: 20px; height:20px;"></a> 
               <a href="https://sphinx.edu.eg/" target="_blank"><img src="assets/img/Sphinx.png" alt=""  style="width: 20px; height:20px;"></a> 
            </div>
            </div>
            
            <div class="header-controls">
                <div class="control-buttons">
                    <button class="dark-mode-toggle" id="darkModeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    
                    
                    <select id="locationSelector" class="modern-select">
                        <option value="all">All Locations</option>
                        <option value="toshka">üìç Toshka</option>
                        <option value="eastowinat">üìç East Oweinat</option>
                    </select>
                    
                    <input type="text" id="datePicker" placeholder="Select date range" class="date-input" />
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="left-content">
            <!-- Crop Selection Section -->
            <section class="crop-selection-section">
                <h2 class="section-title">
                    <i class="fas fa-leaf"></i>
                    Crop Management Overview
                </h2>
                
                <div class="crop-cards-container" id="cropCards">
                    <!-- Crop cards will be dynamically generated -->
                </div>
            </section>

            <!-- Crop Varieties Section -->
            <section class="crop-varieties" id="cropVarieties">
                <h3 class="section-title">
                    <i class="fas fa-seedling"></i>
                    <span id="selectedCropName">Crop</span> Varieties
                </h3>
                <div class="varieties-content">
                    <div class="varieties-list" id="varietiesGrid">
                        <!-- Varieties will be dynamically generated -->
                    </div>
                    <div class="varieties-map">
                        <div id="varietiesMapContainer"></div>
                    </div>
                </div>
            </section>

            <!-- Production Chart -->
            <section class="chart-container">
                <div class="chart-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-area"></i>
                        Production Trends Analysis
                    </h3>
                    <div class="chart-controls">
                        <button class="chart-btn active" data-period="1y">1Y</button>
                    </div>
                </div>
                <div id="productionChart"></div>
            </section>

            <!-- Comparison Chart Section -->
            <section class="comparison-section">
                <div class="comparison-header">
                    <h3 class="chart-title">
                        <i class="fas fa-chart-line"></i>
                        Location Comparison
                    </h3>
                    <div class="location-tabs">
                        <button class="location-tab active" data-location="both">Both</button>
                        <button class="location-tab toshka" data-location="toshka">Toshka</button>
                        <button class="location-tab eastowinat" data-location="eastowinat">East Oweinat</button>
                    </div>
                </div>
                <div id="comparisonChart"></div>
            </section>
        </div>

        <div class="right-sidebar">
            <!-- Weather Widget -->
            <section class="sidebar-section">
                <h3 class="sidebar-title">
                    <i class="fas fa-cloud-sun"></i>
                    Weather Information
                </h3>
                <div class="weather-widget">
                    <div class="weather-current">
                        <div class="weather-temp" id="sidebarTemp"></div>
                        <div class="weather-condition" id="sidebarCondition"></div>
                    </div>
                    <div class="weather-details-grid">
                        <div class="weather-detail-item">
                            <div class="weather-detail-value" id="sidebarWind"></div>
                            <div class="weather-detail-label">Wind Speed</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-value" id="sidebarHumidity"></div>
                            <div class="weather-detail-label">Humidity</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-value" id="sidebarPressure"></div>
                            <div class="weather-detail-label">Pressure</div>
                        </div>
                        <div class="weather-detail-item">
                            <div class="weather-detail-value" id="sidebarVisibility"></div>
                            <div class="weather-detail-label">Visibility</div>
                        </div>
                    </div>
                    <div class="weather-forecast" id="weatherForecast">
                        <!-- Forecast will be dynamically generated by getWeather() -->
                    </div>
                </div>
            </section>

            <!-- Weather Analysis Chart Section -->
            <section class="sidebar-section weather-analysis-section" style="display:block;">
                <h3 class="weather-analysis-title">
                    <i class="fas fa-chart-line"></i>
                    Weather Trends
                </h3>
                <div id="weatherAnalysisChart" style="height:210px;"></div>
            </section>

            <!-- Overall Crops Map -->
            <section class="sidebar-section crops-map-section">
                <h3 class="sidebar-title">
                    <i class="fas fa-map-marked-alt"></i>
                    Crops Location Map
                </h3>
                <div class="crops-map-container">
                    <div id="cropsMapContainer"></div>
                </div>
            </section>

            <!-- Enhanced Key Metrics -->
            <section class="sidebar-section key-metrics">
                <h3 class="sidebar-title">
                    <i class="fas fa-tachometer-alt"></i>
                    Key Metrics
                </h3>
                <div class="metrics-grid" id="metricsGrid">
                    <!-- Metrics will be dynamically generated -->
                </div>
            </section>
        </div>
    </main>

        <script>

            // Initial render: use CropCardsView module
            window.addEventListener('DOMContentLoaded', () => {
              import('./assets/js/view/CropCardsView.js').then(({ CropCardsView }) => {
                CropCardsView.render(document.getElementById('cropCards'));
              });
            });
            
            
            // Listen for location selector changes
            const locationSelectorEl = document.getElementById('locationSelector');
            if (locationSelectorEl) {
              locationSelectorEl.addEventListener('change', function() {
                // Re-render crop cards for new location using CropCardsView module
                import('./assets/js/view/CropCardsView.js').then(({ CropCardsView }) => {
                  CropCardsView.render(document.getElementById('cropCards'));
                });
              });
            }
            </script>
        <script type="module" src="assets/js/main.js"></script>
        <script>
            async function getWeather(location = 'Egypt') {
  const apiKey = '2063af61c85641aa8fb120249250909';
  const url = (loc) => `https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${loc}&days=3&aqi=no`;
  let locations = [];
  if (location === 'all') {
    locations = ['22.6137,31.2889,Toshka', '22.2257,28.7374,Sharq El Owainat'];
  } else if (location === 'toshka') {
    locations = ['22.6137,31.2889,Toshka'];
  } else if (location === 'eastowinat') {
    locations = ['22.2257,28.7374,Sharq El Owainat'];
  } else {
    locations = [location];
  }
  try {
    const results = await Promise.all(locations.map(loc => fetch(url(loc)).then(r => r.json())));
    // If averaging, do so for all metrics
    let avg = (arr) => arr.reduce((a, b) => a + b, 0) / arr.length;
    let weather = results[0];
    if (locations.length === 2) {
      // Average current metrics
      const temp = avg(results.map(r => r.current.temp_c));
      const wind = avg(results.map(r => r.current.wind_kph));
      const humidity = avg(results.map(r => r.current.humidity));
      const pressure = avg(results.map(r => r.current.pressure_mb));
      const visibility = avg(results.map(r => r.current.vis_km));
      // Average forecast metrics for today, tomorrow, day after
      const forecast = [0,1,2].map(i => {
        return {
          date: results[0].forecast.forecastday[i].date,
          avgtemp_c: avg(results.map(r => r.forecast.forecastday[i].day.avgtemp_c)),
          maxtemp_c: avg(results.map(r => r.forecast.forecastday[i].day.maxtemp_c)),
        };
      });
      // Update UI
      document.getElementById('sidebarTemp').textContent = `${temp.toFixed(1)}¬∞C`;
      document.getElementById('sidebarCondition').textContent = 'Average';
      document.getElementById('sidebarWind').textContent = `${wind.toFixed(1)} km/h`;
      document.getElementById('sidebarHumidity').textContent = `${humidity.toFixed(1)}%`;
      document.getElementById('sidebarPressure').textContent = `${pressure.toFixed(1)} hPa`;
      document.getElementById('sidebarVisibility').textContent = `${visibility.toFixed(1)} km`;
      const forecastDiv = document.getElementById('weatherForecast');
      forecastDiv.innerHTML = '';
      ['Today', 'Tomorrow', 'Day After'].forEach((label, idx) => {
        const day = forecast[idx];
        const forecastItem = document.createElement('div');
        forecastItem.className = 'forecast-item';
        forecastItem.innerHTML = `<span class="forecast-day">${label}</span><span class="forecast-temp">${day.avgtemp_c.toFixed(1)}¬∞C</span>`;
        forecastDiv.appendChild(forecastItem);
      });
      return;
    } else {
      // Single location, use as before
      document.getElementById('sidebarTemp').textContent = `${weather.current.temp_c}¬∞C`;
      document.getElementById('sidebarCondition').textContent = weather.current.condition.text;
      document.getElementById('sidebarWind').textContent = `${weather.current.wind_kph} km/h`;
      document.getElementById('sidebarHumidity').textContent = `${weather.current.humidity}%`;
      document.getElementById('sidebarPressure').textContent = `${weather.current.pressure_mb} hPa`;
      document.getElementById('sidebarVisibility').textContent = `${weather.current.vis_km} km`;
      const forecastDiv = document.getElementById('weatherForecast');
      forecastDiv.innerHTML = '';
      if (weather.forecast && weather.forecast.forecastday) {
        weather.forecast.forecastday.slice(0,3).forEach((day, idx) => {
          const labels = ['Today', 'Tomorrow', 'Day After'];
          const forecastItem = document.createElement('div');
          forecastItem.className = 'forecast-item';
          forecastItem.innerHTML = `<span class="forecast-day">${labels[idx]}</span><span class="forecast-temp">${day.day.avgtemp_c}¬∞C</span>`;
          forecastDiv.appendChild(forecastItem);
        });
      }
    }
  } catch (error) {
    console.error('Weather API error:', error);
  }
}

// Listen for location selector changes
const locationSelector = document.getElementById('locationSelector');
if (locationSelector) {
  locationSelector.addEventListener('change', function() {
    getWeather(this.value);
  });
}
// Initial weather render
getWeather(locationSelector ? locationSelector.value : 'all');
        </script>
    <footer class="site-footer">
  <p>¬© <span id="year"></span> All rights reserved to Al Dahra</p>
  
  <nav class="footer-nav" style="">
    <a href="https://aldahra.com/" class="footer-link" title="Go to Home" target="_blank">Home</a>
    <a href="about.htm" class="footer-link" title="Learn About Us" target="_blank">About Us</a>
    <a href="https://aldahra.com/careers/" class="footer-link" title="Explore Careers "target="_blank">Careers</a>
    <a href="https://aldahra.com/contact/" class="footer-link" title="Get in Touch" target="_blank">Contact</a>
  </nav>
</footer>

<script>
  // Auto-update year
  document.getElementById("year").textContent = new Date().getFullYear();
</script>

</body>
</html>
